<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh m·ª•c s√°ch - Th∆∞ vi·ªán HAUI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo-area">
                    <img src="https://cdn-icons-png.flaticon.com/512/2232/2232688.png" alt="Logo" class="sidebar-logo">
                    <span>H·ªá th·ªëng th∆∞ vi·ªán</span>
                </div>
            </div>
            
            <nav class="sidebar-menu">
                <a href="index.html" class="menu-item">
                    <i class="fa-solid fa-house"></i>
                    <span>B·∫£ng ƒëi·ªÅu khi·ªÉn</span>
                </a>
                <a href="books.html" class="menu-item active">
                    <i class="fa-solid fa-book-open"></i>
                    <span>Danh m·ª•c s√°ch</span>
                </a>
                <a href="#" class="menu-item" onclick="showDemoAlert('Thi·∫øt b·ªã')">
                    <i class="fa-solid fa-desktop"></i>
                    <span>Danh m·ª•c thi·∫øt b·ªã</span>
                </a>
                <a href="cart.html" class="menu-item">
                    <i class="fa-solid fa-cart-shopping"></i>
                    <span>Gi·ªè h√†ng c·ªßa t√¥i</span>
                    <span class="menu-badge" id="cartBadge">0</span>
                </a>
                
                <a href="#" class="menu-item" onclick="showDemoAlert('QR')">
                    <i class="fa-solid fa-qrcode"></i>
                    <span>V√© m∆∞·ª£n QR</span>
                </a>

                <a href="#" class="menu-item" onclick="showDemoAlert('ƒêi·ªÉm danh')">
                    <i class="fa-solid fa-user-check"></i>
                    <span>S·ª± c√≥ m·∫∑t c·ªßa t√¥i</span>
                </a>
                
                <a href="lichsu.html" class="menu-item">
                    <i class="fa-solid fa-clock-rotate-left"></i>
                    <span>L·ªãch s·ª≠ m∆∞·ª£n c·ªßa t√¥i</span>
                </a>

                <a href="#" class="menu-item" onclick="showDemoAlert('M·∫≠t kh·∫©u')">
                    <i class="fa-solid fa-user-lock"></i>
                    <span>Thay ƒë·ªïi m·∫≠t kh·∫©u</span>
                </a>
            </nav>
        </aside>

        <main class="main-content">
            <header class="top-bar">
                <h1 class="page-title">üìö Danh m·ª•c s√°ch</h1> 
                <div class="user-profile">
                    <div class="user-info">
                        <span class="user-name">Nguy·ªÖn VƒÉn A</span>
                        <span class="user-email">nguyenvana@student.haui.edu.vn</span>
                    </div>
                    <i class="fa-solid fa-arrow-right-from-bracket logout-icon" onclick="logout()"></i>
                </div>
            </header>

            <div class="content-wrapper">
                <div id="books-catalog" class="view-section">
                    <div class="page-header">
                        <i class="fa-solid fa-book-open title-icon text-primary"></i>
                        <div class="header-text">
                            <h2>Kh√°m ph√° kho s√°ch th∆∞ vi·ªán</h2>
                            <p>T√¨m ki·∫øm v√† m∆∞·ª£n s√°ch t·ª´ danh m·ª•c ƒëa d·∫°ng c·ªßa ch√∫ng t√¥i</p>
                        </div>
                    </div>

                    <div class="stats-row">
                        <div class="stat-card border-primary">
                            <div class="stat-content">
                                <span class="stat-label">T·ªïng s·ªë s√°ch</span>
                                <span class="stat-value" id="totalBooks">0</span>
                                <span class="stat-sub">M·ªçi th·ªÉ lo·∫°i</span>
                            </div>
                            <div class="stat-icon icon-primary">
                                <i class="fa-solid fa-book"></i>
                            </div>
                        </div>
                        <div class="stat-card border-success">
                            <div class="stat-content">
                                <span class="stat-label">S√°ch C√¥ng ngh·ªá</span>
                                <span class="stat-value text-success-bold" id="techBooks">0</span>
                                <span class="stat-sub">CNTT & M√°y t√≠nh</span>
                            </div>
                            <div class="stat-icon icon-success">
                                <i class="fa-solid fa-laptop-code"></i>
                            </div>
                        </div>
                        <div class="stat-card border-warning">
                            <div class="stat-content">
                                <span class="stat-label">S√°ch VƒÉn h·ªçc</span>
                                <span class="stat-value text-warning-bold" id="literatureBooks">0</span>
                                <span class="stat-sub">VƒÉn h·ªçc trong n∆∞·ªõc & qu·ªëc t·∫ø</span>
                            </div>
                            <div class="stat-icon icon-warning">
                                <i class="fa-solid fa-book-open"></i>
                            </div>
                        </div>
                        <div class="stat-card border-info">
                            <div class="stat-content">
                                <span class="stat-label">S√°ch Ngo·∫°i ng·ªØ</span>
                                <span class="stat-value text-info-bold" id="languageBooks">0</span>
                                <span class="stat-sub">Ti·∫øng Anh, Nh·∫≠t, H√†n...</span>
                            </div>
                            <div class="stat-icon icon-info">
                                <i class="fa-solid fa-globe"></i>
                            </div>
                        </div>
                    </div>

                    <div class="section-card">
                        <div class="section-header">
                            <h3>T√¨m ki·∫øm & L·ªçc s√°ch</h3>
                        </div>
                        
                        <div class="search-controls">
                            <div class="search-box">
                                <i class="fa-solid fa-search"></i>
                                <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm s√°ch theo t√™n, t√°c gi·∫£...">
                                <button class="btn btn-primary" onclick="searchBooks()">T√¨m ki·∫øm</button>
                                <button class="btn btn-secondary" onclick="resetFilters()">L√†m m·ªõi</button>
                            </div>
                            
                            <div class="filter-controls">
                                <div class="filter-group">
                                    <label for="categoryFilter">Th·ªÉ lo·∫°i:</label>
                                    <select id="categoryFilter" onchange="searchBooks()">
                                        <option value="0">T·∫•t c·∫£ th·ªÉ lo·∫°i</option>
                                        <option value="1">C√¥ng ngh·ªá th√¥ng tin</option>
                                        <option value="2">VƒÉn h·ªçc</option>
                                        <option value="3">Ngo·∫°i ng·ªØ</option>
                                        <option value="4">K·ªπ nƒÉng s·ªëng</option>
                                    </select>
                                </div>
                                
                                <div class="filter-group">
                                    <label for="yearFilter">NƒÉm xu·∫•t b·∫£n:</label>
                                    <select id="yearFilter" onchange="searchBooks()">
                                        <option value="0">T·∫•t c·∫£ nƒÉm</option>
                                        <!-- NƒÉm s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JS -->
                                    </select>
                                </div>
                                
                                <div class="filter-group">
                                    <label for="sortFilter">S·∫Øp x·∫øp:</label>
                                    <select id="sortFilter" onchange="searchBooks()">
                                        <option value="newest">M·ªõi nh·∫•t</option>
                                        <option value="oldest">C≈© nh·∫•t</option>
                                        <option value="name_asc">T√™n A-Z</option>
                                        <option value="name_desc">T√™n Z-A</option>
                                        <option value="stock_desc">S·ªë l∆∞·ª£ng gi·∫£m d·∫ßn</option>
                                        <option value="stock_asc">S·ªë l∆∞·ª£ng tƒÉng d·∫ßn</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="action-buttons">
                                <button class="btn btn-warning" onclick="showLowStock()">
                                    <i class="fa-solid fa-exclamation-triangle"></i> S√°ch s·∫Øp h·∫øt
                                </button>
                                <button class="btn btn-danger" onclick="showOutOfStock()">
                                    <i class="fa-solid fa-times-circle"></i> H·∫øt s√°ch
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="section-divider">
                        <div class="section-header">
                            <i class="fa-solid fa-books"></i>
                            <h3>Danh s√°ch s√°ch</h3>
                        </div>
                        <p class="section-desc">Hi·ªÉn th·ªã <span id="displayCount">0</span> s√°ch</p>
                    </div>

                    <div class="books-grid" id="booksContainer">
                        <!-- S√°ch s·∫Ω ƒë∆∞·ª£c t·∫£i ·ªü ƒë√¢y -->
                    </div>

                    <div class="pagination" id="pagination">
                        <!-- Ph√¢n trang s·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JS -->
                    </div>
                </div>
            </div>
            
            <footer class="main-footer">
                <div class="footer-center">
                    <img src="https://cdn-icons-png.flaticon.com/512/2232/2232688.png" alt="Logo" class="footer-logo">
                    <span>Th∆∞ vi·ªán HAUI</span>
                </div>
                <div class="footer-right">
                    <span>¬© 2025 Th∆∞ vi·ªán HAUI</span>
                    <a href="#" onclick="showDemoAlert('Ch√≠nh s√°ch ri√™ng t∆∞')">S·ª± ri√™ng t∆∞</a>
                    <a href="#" onclick="showDemoAlert('ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng')">ƒêi·ªÅu kho·∫£n</a>
                </div>
            </footer>
        </main>
    </div>

    <!-- Modal chi ti·∫øt s√°ch -->
    <div class="modal-overlay" id="bookModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modalTitle">Chi ti·∫øt s√°ch</h2>
                <p id="modalAuthor"></p>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn b·∫±ng JS -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">ƒê√≥ng</button>
                <button class="btn btn-primary" id="modalAddCartBtn" onclick="addToCartSelected()">
                    <i class="fa-solid fa-cart-plus"></i> Th√™m v√†o gi·ªè h√†ng
                </button>
            </div>
        </div>
    </div>

    <script>
        // Bi·∫øn to√†n c·ª•c
        let allBooks = [];
        let filteredBooks = [];
        let currentPage = 1;
        const booksPerPage = 12;
        let currentBookId = null;

        // Kh·ªüi t·∫°o trang
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            setupEventListeners();
            checkUrlFilters();
        });

        function initializePage() {
            // Load d·ªØ li·ªáu t·ª´ localStorage
            loadLibraryData();
            
            updateStats();
            populateYearFilter();
            displayBooks();
            updateDisplayCount();
            updateCartBadge();
        }

        function loadLibraryData() {
            // Ki·ªÉm tra xem ƒë√£ c√≥ d·ªØ li·ªáu trong localStorage ch∆∞a
            let data = JSON.parse(localStorage.getItem('libraryData'));
            
            // N·∫øu ch∆∞a c√≥ d·ªØ li·ªáu, t·∫°o d·ªØ li·ªáu m·∫´u
            if (!data || !data.sach || data.sach.length === 0) {
                console.log('T·∫°o d·ªØ li·ªáu m·∫´u...');
                data = {
                    "theLoai": [
                        { "id": 1, "ten": "C√¥ng ngh·ªá th√¥ng tin" },
                        { "id": 2, "ten": "VƒÉn h·ªçc" },
                        { "id": 3, "ten": "Ngo·∫°i ng·ªØ" },
                        { "id": 4, "ten": "K·ªπ nƒÉng s·ªëng" }
                    ],
                    "sach": [],
                    "docGia": [
                        { "id": 1, "hoTen": "Nguy·ªÖn VƒÉn An", "email": "an@gmail.com", "dienThoai": "0901234561" }
                    ],
                    "muonTra": [],
                    "yeuCauDat": [],
                    "admin": [
                        { "id": 1, "taiKhoan": "admin", "matKhau": "123456", "vaiTro": "Qu·∫£n tr·ªã vi√™n" }
                    ]
                };
                
                // Th√™m s√°ch m·∫´u
                const sampleBooks = [
                    { "id": 1, "tieuDe": "L·∫≠p Tr√¨nh Java C∆° B·∫£n", "tacGia": "Nguy·ªÖn VƒÉn A", "theLoaiId": 1, "namXuatBan": 2020, "soLuong": 12, "description": "Gi·ªõi thi·ªáu to√†n di·ªán v·ªÅ l·∫≠p tr√¨nh Java t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao. S√°ch bao g·ªìm c√°c kh√°i ni·ªám c∆° b·∫£n, h∆∞·ªõng ƒë·ªëi t∆∞·ª£ng, x·ª≠ l√Ω ngo·∫°i l·ªá v√† l·∫≠p tr√¨nh giao di·ªán." },
                    { "id": 2, "tieuDe": "H∆∞·ªõng D·∫´n HTML & CSS", "tacGia": "Tr·∫ßn Th·ªã B", "theLoaiId": 1, "namXuatBan": 2019, "soLuong": 7, "description": "H∆∞·ªõng d·∫´n chi ti·∫øt v·ªÅ ph√°t tri·ªÉn web v·ªõi HTML5 v√† CSS3. Bao g·ªìm c√°c k·ªπ thu·∫≠t hi·ªán ƒë·∫°i nh∆∞ Flexbox, Grid v√† Responsive Design." },
                    { "id": 3, "tieuDe": "C·∫•u Tr√∫c D·ªØ Li·ªáu & Gi·∫£i Thu·∫≠t", "tacGia": "L√™ Minh C", "theLoaiId": 1, "namXuatBan": 2021, "soLuong": 5, "description": "Kh√°m ph√° c√°c c·∫•u tr√∫c d·ªØ li·ªáu v√† gi·∫£i thu·∫≠t c∆° b·∫£n trong khoa h·ªçc m√°y t√≠nh. Bao g·ªìm m·∫£ng, danh s√°ch li√™n k·∫øt, c√¢y, ƒë·ªì th·ªã v√† c√°c thu·∫≠t to√°n s·∫Øp x·∫øp, t√¨m ki·∫øm." },
                    { "id": 4, "tieuDe": "VƒÉn H·ªçc Vi·ªát Nam Hi·ªán ƒê·∫°i", "tacGia": "T·ªë H·ªØu", "theLoaiId": 2, "namXuatBan": 2015, "soLuong": 20, "description": "Tuy·ªÉn t·∫≠p c√°c t√°c ph·∫©m vƒÉn h·ªçc Vi·ªát Nam hi·ªán ƒë·∫°i, ph·∫£n √°nh ƒë·ªùi s·ªëng x√£ h·ªôi v√† t√¢m t∆∞ con ng∆∞·ªùi Vi·ªát Nam qua c√°c th·ªùi k·ª≥." },
                    { "id": 5, "tieuDe": "Ti·∫øng Anh Giao Ti·∫øp", "tacGia": "John Smith", "theLoaiId": 3, "namXuatBan": 2018, "soLuong": 9, "description": "S√°ch h∆∞·ªõng d·∫´n ti·∫øng Anh giao ti·∫øp v·ªõi c√°c t√¨nh hu·ªëng th·ª±c t·∫ø, t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao, gi√∫p ng∆∞·ªùi h·ªçc t·ª± tin trong giao ti·∫øp." },
                    { "id": 6, "tieuDe": "K·ªπ NƒÉng S·ªëng Cho Sinh Vi√™n", "tacGia": "Ph·∫°m H∆∞∆°ng", "theLoaiId": 4, "namXuatBan": 2017, "soLuong": 14, "description": "Cung c·∫•p c√°c k·ªπ nƒÉng s·ªëng c·∫ßn thi·∫øt cho sinh vi√™n: qu·∫£n l√Ω th·ªùi gian, giao ti·∫øp, l√†m vi·ªác nh√≥m v√† ph√°t tri·ªÉn b·∫£n th√¢n." },
                    { "id": 7, "tieuDe": "L·∫≠p Tr√¨nh Python C∆° B·∫£n", "tacGia": "Nguy·ªÖn T·∫•n D≈©ng", "theLoaiId": 1, "namXuatBan": 2021, "soLuong": 10, "description": "H∆∞·ªõng d·∫´n l·∫≠p tr√¨nh Python t·ª´ c∆° b·∫£n, ph√π h·ª£p cho ng∆∞·ªùi m·ªõi b·∫Øt ƒë·∫ßu. Bao g·ªìm c√∫ ph√°p, c·∫•u tr√∫c d·ªØ li·ªáu v√† ·ª©ng d·ª•ng th·ª±c t·∫ø." },
                    { "id": 8, "tieuDe": "L·∫≠p Tr√¨nh Web v·ªõi JavaScript", "tacGia": "Ho√†ng Long", "theLoaiId": 1, "namXuatBan": 2022, "soLuong": 8, "description": "Kh√°m ph√° l·∫≠p tr√¨nh web hi·ªán ƒë·∫°i v·ªõi JavaScript, bao g·ªìm ES6+, DOM manipulation, v√† c√°c framework ph·ªï bi·∫øn." },
                    { "id": 9, "tieuDe": "ReactJS N√¢ng Cao", "tacGia": "Ph·∫°m Ch√≠ T√†i", "theLoaiId": 1, "namXuatBan": 2023, "soLuong": 11, "description": "H∆∞·ªõng d·∫´n n√¢ng cao v·ªÅ ReactJS v·ªõi hooks, context API, performance optimization v√† testing." },
                    { "id": 10, "tieuDe": "NodeJS Cho Ng∆∞·ªùi M·ªõi", "tacGia": "Tr·∫ßn H·ªØu Nghƒ©a", "theLoaiId": 1, "namXuatBan": 2020, "soLuong": 6, "description": "Gi·ªõi thi·ªáu v·ªÅ NodeJS v√† ph√°t tri·ªÉn backend, bao g·ªìm Express.js, REST API, v√† k·∫øt n·ªëi database." },
                    { "id": 11, "tieuDe": "Ph√¢n T√≠ch Thi·∫øt K·∫ø H·ªá Th·ªëng", "tacGia": "Nguy·ªÖn H·ªØu Khoa", "theLoaiId": 1, "namXuatBan": 2018, "soLuong": 9, "description": "H∆∞·ªõng d·∫´n ph√¢n t√≠ch v√† thi·∫øt k·∫ø h·ªá th·ªëng ph·∫ßn m·ªÅm, t·ª´ y√™u c·∫ßu ƒë·∫øn tri·ªÉn khai." },
                    { "id": 12, "tieuDe": "SQL Server T·ª´ C∆° B·∫£n ƒê·∫øn N√¢ng Cao", "tacGia": "L√™ VƒÉn Minh", "theLoaiId": 1, "namXuatBan": 2021, "soLuong": 16, "description": "H·ªçc SQL Server t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao, bao g·ªìm truy v·∫•n, qu·∫£n l√Ω database v√† optimization." },
                    { "id": 13, "tieuDe": "MongoDB Th·ª±c H√†nh", "tacGia": "H·ªì Thanh S∆°n", "theLoaiId": 1, "namXuatBan": 2019, "soLuong": 6, "description": "Th·ª±c h√†nh v·ªõi MongoDB, database NoSQL ph·ªï bi·∫øn cho ·ª©ng d·ª•ng hi·ªán ƒë·∫°i." },
                    { "id": 14, "tieuDe": "Docker & DevOps", "tacGia": "ƒê·∫∑ng Ng·ªçc H·∫£i", "theLoaiId": 1, "namXuatBan": 2022, "soLuong": 10, "description": "H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng Docker v√† c√°c c√¥ng c·ª• DevOps ƒë·ªÉ tri·ªÉn khai ·ª©ng d·ª•ng hi·ªáu qu·∫£." },
                    { "id": 15, "tieuDe": "L·∫≠p Tr√¨nh Kotlin", "tacGia": "Ho√†ng VƒÉn T√∫", "theLoaiId": 1, "namXuatBan": 2020, "soLuong": 12, "description": "H·ªçc l·∫≠p tr√¨nh Kotlin cho ph√°t tri·ªÉn Android v√† ·ª©ng d·ª•ng ƒëa n·ªÅn t·∫£ng." },
                    { "id": 16, "tieuDe": "VƒÉn H·ªçc Trung ƒê·∫°i Vi·ªát Nam", "tacGia": "Nhi·ªÅu t√°c gi·∫£", "theLoaiId": 2, "namXuatBan": 2010, "soLuong": 18, "description": "Tuy·ªÉn t·∫≠p c√°c t√°c ph·∫©m vƒÉn h·ªçc trung ƒë·∫°i Vi·ªát Nam, ph·∫£n √°nh vƒÉn h√≥a v√† l·ªãch s·ª≠ d√¢n t·ªôc." },
                    { "id": 17, "tieuDe": "T√°c Ph·∫©m Ch·ªçn L·ªçc - Nam Cao", "tacGia": "Nam Cao", "theLoaiId": 2, "namXuatBan": 2013, "soLuong": 22, "description": "Tuy·ªÉn t·∫≠p c√°c t√°c ph·∫©m ti√™u bi·ªÉu c·ªßa nh√† vƒÉn Nam Cao, ƒë·∫°i di·ªán cho vƒÉn h·ªçc hi·ªán th·ª±c Vi·ªát Nam." },
                    { "id": 18, "tieuDe": "Tuy·ªÉn T·∫≠p Th∆° Xu√¢n Di·ªáu", "tacGia": "Xu√¢n Di·ªáu", "theLoaiId": 2, "namXuatBan": 2014, "soLuong": 17, "description": "Tuy·ªÉn t·∫≠p th∆° c·ªßa Xu√¢n Di·ªáu, √¥ng ho√†ng th∆° t√¨nh Vi·ªát Nam v·ªõi nh·ªØng v·∫ßn th∆° l√£ng m·∫°n." },
                    { "id": 19, "tieuDe": "T·ªë T√¢m", "tacGia": "Ho√†ng Ng·ªçc Ph√°ch", "theLoaiId": 2, "namXuatBan": 2009, "soLuong": 10, "description": "Ti·ªÉu thuy·∫øt l√£ng m·∫°n n·ªïi ti·∫øng c·ªßa Ho√†ng Ng·ªçc Ph√°ch, t√°c ph·∫©m ti√™u bi·ªÉu c·ªßa vƒÉn h·ªçc Vi·ªát Nam ƒë·∫ßu th·∫ø k·ª∑ 20." },
                    { "id": 20, "tieuDe": "D·∫ø M√®n Phi√™u L∆∞u K√Ω", "tacGia": "T√¥ Ho√†i", "theLoaiId": 2, "namXuatBan": 2011, "soLuong": 25, "description": "T√°c ph·∫©m thi·∫øu nhi kinh ƒëi·ªÉn c·ªßa T√¥ Ho√†i, k·ªÉ v·ªÅ cu·ªôc phi√™u l∆∞u c·ªßa ch√∫ D·∫ø M√®n." }
                ];
                
                data.sach = sampleBooks;
                localStorage.setItem('libraryData', JSON.stringify(data));
            }
            
            allBooks = data.sach;
            filteredBooks = [...allBooks];
        }

        function setupEventListeners() {
            // T√¨m ki·∫øm b·∫±ng Enter
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') searchBooks();
            });
        }

        function checkUrlFilters() {
            const urlParams = new URLSearchParams(window.location.search);
            const filter = urlParams.get('filter');
            
            if (filter) {
                switch(filter) {
                    case 'low-stock':
                        showLowStock();
                        break;
                    case 'new':
                        document.getElementById('sortFilter').value = 'newest';
                        searchBooks();
                        break;
                    case 'tech':
                        document.getElementById('categoryFilter').value = '1';
                        searchBooks();
                        break;
                }
            }
        }

        function updateStats() {
            const data = JSON.parse(localStorage.getItem('libraryData')) || { sach: [], theLoai: [] };
            
            // T·ªïng s·ªë s√°ch
            const totalBooks = data.sach.length || 0;
            document.getElementById('totalBooks').textContent = totalBooks;
            
            // S√°ch c√¥ng ngh·ªá
            const techBooks = data.sach.filter(book => book.theLoaiId === 1).length || 0;
            document.getElementById('techBooks').textContent = techBooks;
            
            // S√°ch vƒÉn h·ªçc
            const literatureBooks = data.sach.filter(book => book.theLoaiId === 2).length || 0;
            document.getElementById('literatureBooks').textContent = literatureBooks;
            
            // S√°ch ngo·∫°i ng·ªØ
            const languageBooks = data.sach.filter(book => book.theLoaiId === 3).length || 0;
            document.getElementById('languageBooks').textContent = languageBooks;
            
            // S√°ch k·ªπ nƒÉng
            const skillBooks = data.sach.filter(book => book.theLoaiId === 4).length || 0;
            document.getElementById('skillBooks').textContent = skillBooks;
        }

        function populateYearFilter() {
            const yearFilter = document.getElementById('yearFilter');
            const years = [...new Set(allBooks.map(book => book.namXuatBan))].sort((a, b) => b - a);
            
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = `NƒÉm ${year}`;
                yearFilter.appendChild(option);
            });
        }

        function searchBooks() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryId = parseInt(document.getElementById('categoryFilter').value);
            const year = parseInt(document.getElementById('yearFilter').value);
            const sortBy = document.getElementById('sortFilter').value;

            filteredBooks = allBooks.filter(book => {
                const matchesSearch = !searchTerm || 
                    book.tieuDe.toLowerCase().includes(searchTerm) ||
                    book.tacGia.toLowerCase().includes(searchTerm);
                
                const matchesCategory = !categoryId || book.theLoaiId === categoryId;
                const matchesYear = !year || book.namXuatBan === year;

                return matchesSearch && matchesCategory && matchesYear;
            });

            // S·∫Øp x·∫øp
            switch(sortBy) {
                case 'newest':
                    filteredBooks.sort((a, b) => b.namXuatBan - a.namXuatBan);
                    break;
                case 'oldest':
                    filteredBooks.sort((a, b) => a.namXuatBan - b.namXuatBan);
                    break;
                case 'name_asc':
                    filteredBooks.sort((a, b) => a.tieuDe.localeCompare(b.tieuDe));
                    break;
                case 'name_desc':
                    filteredBooks.sort((a, b) => b.tieuDe.localeCompare(a.tieuDe));
                    break;
                case 'stock_desc':
                    filteredBooks.sort((a, b) => b.soLuong - a.soLuong);
                    break;
                case 'stock_asc':
                    filteredBooks.sort((a, b) => a.soLuong - b.soLuong);
                    break;
            }

            currentPage = 1;
            displayBooks();
            updateDisplayCount();
        }

        function showLowStock() {
            filteredBooks = allBooks.filter(book => book.soLuong > 0 && book.soLuong <= 5);
            document.getElementById('categoryFilter').value = 0;
            document.getElementById('yearFilter').value = 0;
            document.getElementById('searchInput').value = '';
            document.getElementById('sortFilter').value = 'stock_asc';
            currentPage = 1;
            displayBooks();
            updateDisplayCount();
        }

        function showOutOfStock() {
            filteredBooks = allBooks.filter(book => book.soLuong === 0);
            document.getElementById('categoryFilter').value = 0;
            document.getElementById('yearFilter').value = 0;
            document.getElementById('searchInput').value = '';
            document.getElementById('sortFilter').value = 'name_asc';
            currentPage = 1;
            displayBooks();
            updateDisplayCount();
        }

        function resetFilters() {
            document.getElementById('categoryFilter').value = 0;
            document.getElementById('yearFilter').value = 0;
            document.getElementById('searchInput').value = '';
            document.getElementById('sortFilter').value = 'newest';
            filteredBooks = [...allBooks];
            currentPage = 1;
            displayBooks();
            updateDisplayCount();
        }

        function displayBooks() {
            const container = document.getElementById('booksContainer');
            const pagination = document.getElementById('pagination');
            
            // T√≠nh to√°n ph√¢n trang
            const totalPages = Math.ceil(filteredBooks.length / booksPerPage);
            const startIndex = (currentPage - 1) * booksPerPage;
            const endIndex = startIndex + booksPerPage;
            const currentBooks = filteredBooks.slice(startIndex, endIndex);
            
            if (filteredBooks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon"><i class="fa-solid fa-book-open"></i></div>
                        <h3>Kh√¥ng t√¨m th·∫•y s√°ch ph√π h·ª£p</h3>
                        <p>H√£y th·ª≠ thay ƒë·ªïi ti√™u ch√≠ t√¨m ki·∫øm</p>
                        <button class="btn btn-primary" onclick="resetFilters()" style="margin-top: 20px;">
                            <i class="fa-solid fa-book"></i> Hi·ªÉn th·ªã t·∫•t c·∫£ s√°ch
                        </button>
                    </div>
                `;
                pagination.innerHTML = '';
                return;
            }

            container.innerHTML = '';
            
            currentBooks.forEach(book => {
                const data = JSON.parse(localStorage.getItem('libraryData'));
                const category = data.theLoai.find(cat => cat.id === book.theLoaiId);
                const bookElement = document.createElement('div');
                bookElement.className = 'book-card';
                bookElement.innerHTML = `
                    <div class="book-header">
                        <div class="book-badge">ID: ${book.id}</div>
                        <h3 class="book-title">${book.tieuDe}</h3>
                        <p class="book-author"><i class="fa-solid fa-user"></i> ${book.tacGia}</p>
                    </div>
                    <div class="book-body">
                        <div class="book-meta">
                            <div class="meta-item">
                                <span class="meta-label">Th·ªÉ lo·∫°i</span>
                                <span class="meta-value">${category ? category.ten : 'Kh√¥ng x√°c ƒë·ªãnh'}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">NƒÉm XB</span>
                                <span class="meta-value">${book.namXuatBan}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">M√£ TL</span>
                                <span class="meta-value">${book.theLoaiId}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Tr·∫°ng th√°i</span>
                                <span class="meta-value">${getStockStatus(book.soLuong)}</span>
                            </div>
                        </div>
                        <div class="category-tag cat-${book.theLoaiId}">
                            <i class="fa-solid fa-tag"></i> ${category ? category.ten : 'Kh√¥ng x√°c ƒë·ªãnh'}
                        </div>
                    </div>
                    <div class="book-footer">
                        <div class="stock-info">
                            <span class="stock-label">S·ªë l∆∞·ª£ng c√≥ s·∫µn</span>
                            <span class="stock-count ${getStockClass(book.soLuong)}">${book.soLuong}</span>
                        </div>
                        <div class="action-buttons">
                            <button class="action-btn btn-detail" onclick="viewBookDetail(${book.id})">
                                <i class="fa-solid fa-info-circle"></i> Chi ti·∫øt
                            </button>
                            <button class="action-btn btn-borrow" onclick="addToCart(${book.id})" ${book.soLuong === 0 ? 'disabled' : ''}>
                                <i class="fa-solid fa-cart-plus"></i> Th√™m v√†o gi·ªè
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(bookElement);
            });

            // T·∫°o ph√¢n trang
            createPagination(totalPages);
        }

        function getStockStatus(quantity) {
            if (quantity === 0) return 'H·∫øt s√°ch';
            if (quantity <= 5) return 'S·∫Øp h·∫øt';
            if (quantity <= 10) return 'C√≤n √≠t';
            return 'C√≤n nhi·ªÅu';
        }

        function getStockClass(quantity) {
            if (quantity === 0) return 'low';
            if (quantity <= 5) return 'low';
            if (quantity <= 10) return 'medium';
            return 'high';
        }

        function createPagination(totalPages) {
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let paginationHTML = `
                <button class="page-btn" onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                    <i class="fa-solid fa-chevron-left"></i>
                </button>
            `;

            // Hi·ªÉn th·ªã t·ªëi ƒëa 5 trang
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            
            if (endPage - startPage < 4) {
                startPage = Math.max(1, endPage - 4);
            }

            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">
                        ${i}
                    </button>
                `;
            }

            paginationHTML += `
                <button class="page-btn" onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                    <i class="fa-solid fa-chevron-right"></i>
                </button>
                <span class="page-info">
                    Trang ${currentPage} / ${totalPages}
                </span>
            `;

            pagination.innerHTML = paginationHTML;
        }

        function goToPage(page) {
            const totalPages = Math.ceil(filteredBooks.length / booksPerPage);
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            displayBooks();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateDisplayCount() {
            document.getElementById('displayCount').textContent = filteredBooks.length;
        }

        function updateCartBadge() {
            const data = JSON.parse(localStorage.getItem('libraryData')) || { muonTra: [] };
            const userBorrowedBooks = data.muonTra.filter(record => 
                record.docGiaId === 3 && record.trangThai === "ƒêang m∆∞·ª£n"
            ).length;
            document.getElementById('cartBadge').textContent = userBorrowedBooks;
        }

        function viewBookDetail(bookId) {
            currentBookId = bookId;
            const book = allBooks.find(b => b.id === bookId);
            const data = JSON.parse(localStorage.getItem('libraryData'));
            const category = data.theLoai.find(cat => cat.id === book.theLoaiId);
            
            if (!book) return;
            
            document.getElementById('modalTitle').textContent = book.tieuDe;
            document.getElementById('modalAuthor').textContent = `T√°c gi·∫£: ${book.tacGia}`;
            
            // T·∫°o v·ªã tr√≠ ng·∫´u nhi√™n
            const sections = ["Khu A", "Khu B", "Khu C", "Khu D"];
            const shelves = ["K·ªá 1", "K·ªá 2", "K·ªá 3", "K·ªá 4", "K·ªá 5"];
            const randomSection = sections[Math.floor(Math.random() * sections.length)];
            const randomShelf = shelves[Math.floor(Math.random() * shelves.length)];
            
            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `
                <div class="modal-section">
                    <h3>Kh·∫£ d·ª•ng</h3>
                    <div class="availability-info">
                        <span>${book.soLuong} trong ${book.soLuong + 5}</span> b·∫£n c√≥ s·∫µn
                    </div>
                    <div class="location-info">
                        <strong>V·ªã tr√≠</strong>
                        ${randomSection}, ${randomShelf} trong th∆∞ vi·ªán
                    </div>
                </div>
                
                <div class="modal-section">
                    <h3>Th√¥ng tin s√°ch</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">M√£ s√°ch</span>
                            <span class="info-value">${book.id}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ISBN</span>
                            <span class="info-value">978-0-${String(book.id).padStart(6, '0')}-${String(book.namXuatBan).slice(-2)}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Th·ªÉ lo·∫°i</span>
                            <span class="info-value">${category ? category.ten : 'Kh√¥ng x√°c ƒë·ªãnh'}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">NƒÉm xu·∫•t b·∫£n</span>
                            <span class="info-value">${book.namXuatBan}</span>
                        </div>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h3>M√¥ t·∫£</h3>
                    <div class="description">
                        ${book.description || `Gi·ªõi thi·ªáu to√†n di·ªán v·ªÅ ${category.ten.toLowerCase()}. S√°ch n√†y bao g·ªìm c√°c kh√°i ni·ªám c∆° b·∫£n v√† cung c·∫•p v√≠ d·ª• th·ª±c t·∫ø cho ng∆∞·ªùi h·ªçc.`}
                    </div>
                </div>
                
                <div class="stock-status">
                    <div class="status-label">
                        Tr·∫°ng th√°i kho hi·ªán t·∫°i: 
                        <span class="status-value ${getStockClass(book.soLuong)}">
                            ${getStockStatus(book.soLuong)}
                        </span>
                    </div>
                </div>
            `;
            
            const addCartBtn = document.getElementById('modalAddCartBtn');
            addCartBtn.disabled = book.soLuong === 0;
            addCartBtn.textContent = book.soLuong === 0 ? 'H·∫øt h√†ng' : 'Th√™m v√†o gi·ªè h√†ng';
            addCartBtn.innerHTML = book.soLuong === 0 ? '<i class="fa-solid fa-times-circle"></i> H·∫øt h√†ng' : '<i class="fa-solid fa-cart-plus"></i> Th√™m v√†o gi·ªè h√†ng';
            
            openModal();
        }

        function addToCart(bookId) {
            const book = allBooks.find(b => b.id === bookId);
            
            if (book.soLuong === 0) {
                alert('‚õî R·∫•t ti·∫øc, s√°ch n√†y ƒë√£ h·∫øt!');
                return;
            }

            if (confirm(`Th√™m s√°ch v√†o gi·ªè h√†ng:\n"${book.tieuDe}"\n\nT√°c gi·∫£: ${book.tacGia}\nS·ªë l∆∞·ª£ng c√≤n: ${book.soLuong}`)) {
                // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng
                book.soLuong -= 1;
                
                // C·∫≠p nh·∫≠t localStorage
                const data = JSON.parse(localStorage.getItem('libraryData'));
                const bookIndex = data.sach.findIndex(b => b.id === bookId);
                if (bookIndex !== -1) {
                    data.sach[bookIndex].soLuong = book.soLuong;
                    
                    // Th√™m v√†o l·ªãch s·ª≠ m∆∞·ª£n (Nguy·ªÖn VƒÉn A - ID 3)
                    const borrowId = data.muonTra.length > 0 ? Math.max(...data.muonTra.map(m => m.id)) + 1 : 1;
                    const today = new Date();
                    const dueDate = new Date();
                    dueDate.setDate(today.getDate() + 14); // H·∫°n tr·∫£ sau 14 ng√†y
                    
                    const borrowRecord = {
                        id: borrowId,
                        docGiaId: 3, // Nguy·ªÖn VƒÉn A
                        sachId: bookId,
                        ngayMuon: today.toISOString().split('T')[0],
                        hanTra: dueDate.toISOString().split('T')[0],
                        trangThai: "ƒêang m∆∞·ª£n"
                    };
                    
                    data.muonTra.push(borrowRecord);
                    localStorage.setItem('libraryData', JSON.stringify(data));
                }
                
                // C·∫≠p nh·∫≠t l·∫°i d·ªØ li·ªáu
                loadLibraryData();
                updateStats();
                displayBooks();
                updateCartBadge();
                closeModal();
                alert('‚úÖ ƒê√£ th√™m s√°ch v√†o gi·ªè h√†ng th√†nh c√¥ng!');
            }
        }

        function addToCartSelected() {
            if (currentBookId) {
                addToCart(currentBookId);
            }
        }

        function openModal() {
            document.getElementById('bookModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('bookModal').style.display = 'none';
            currentBookId = null;
        }

        function logout() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t?')) {
                alert('ƒêƒÉng xu·∫•t th√†nh c√¥ng!');
            }
        }
        
        function showDemoAlert(feature) {
            alert(`T√≠nh nƒÉng "${feature}" ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn. Vui l√≤ng th·ª≠ l·∫°i sau!`);
        }

        // ƒê√≥ng modal khi click b√™n ngo√†i
        document.getElementById('bookModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>