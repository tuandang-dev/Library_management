<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi·ªè h√†ng c·ªßa t√¥i - Th∆∞ vi·ªán HAUI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo-area">
                    <img src="https://cdn-icons-png.flaticon.com/512/2232/2232688.png" alt="Logo" class="sidebar-logo">
                    <span>H·ªá th·ªëng th∆∞ vi·ªán</span>
                </div>
            </div>
            
            <nav class="sidebar-menu">
                <a href="index.html" class="menu-item">
                    <i class="fa-solid fa-house"></i>
                    <span>B·∫£ng ƒëi·ªÅu khi·ªÉn</span>
                </a>
                <a href="books.html" class="menu-item">
                    <i class="fa-solid fa-book-open"></i>
                    <span>Danh m·ª•c s√°ch</span>
                </a>
                <a href="#" class="menu-item" onclick="showDemoAlert('Thi·∫øt b·ªã')">
                    <i class="fa-solid fa-desktop"></i>
                    <span>Danh m·ª•c thi·∫øt b·ªã</span>
                </a>
                <a href="cart.html" class="menu-item active">
                    <i class="fa-solid fa-cart-shopping"></i>
                    <span>Gi·ªè h√†ng c·ªßa t√¥i</span>
                    <span class="menu-badge" id="cartBadge">0</span>
                </a>
                
                <a href="#" class="menu-item" onclick="showDemoAlert('QR')">
                    <i class="fa-solid fa-qrcode"></i>
                    <span>V√© m∆∞·ª£n QR</span>
                </a>

                <a href="#" class="menu-item" onclick="showDemoAlert('ƒêi·ªÉm danh')">
                    <i class="fa-solid fa-user-check"></i>
                    <span>S·ª± c√≥ m·∫∑t c·ªßa t√¥i</span>
                </a>
                
                <a href="lichsu.html" class="menu-item">
                    <i class="fa-solid fa-clock-rotate-left"></i>
                    <span>L·ªãch s·ª≠ m∆∞·ª£n c·ªßa t√¥i</span>
                </a>

                <a href="#" class="menu-item" onclick="showDemoAlert('M·∫≠t kh·∫©u')">
                    <i class="fa-solid fa-user-lock"></i>
                    <span>Thay ƒë·ªïi m·∫≠t kh·∫©u</span>
                </a>
            </nav>
        </aside>

        <main class="main-content">
            <header class="top-bar">
                <h1 class="page-title">üõí Gi·ªè h√†ng c·ªßa t√¥i</h1> 
                <div class="user-profile">
                    <div class="user-info">
                        <span class="user-name">Nguy·ªÖn VƒÉn A</span>
                        <span class="user-email">nguyenvana@student.haui.edu.vn</span>
                    </div>
                    <i class="fa-solid fa-arrow-right-from-bracket logout-icon" onclick="logout()"></i>
                </div>
            </header>

            <div class="content-wrapper">
                <div id="my-cart" class="view-section">
                    <div class="page-header">
                        <i class="fa-solid fa-cart-shopping title-icon text-primary"></i>
                        <div class="header-text">
                            <h2>Danh s√°ch s√°ch ƒëang m∆∞·ª£n</h2>
                            <p>Qu·∫£n l√Ω v√† theo d√µi c√°c s√°ch b·∫°n ƒëang m∆∞·ª£n t·ª´ th∆∞ vi·ªán</p>
                        </div>
                    </div>

                    <div class="stats-row">
                        <div class="stat-card border-primary">
                            <div class="stat-content">
                                <span class="stat-label">S√°ch ƒëang m∆∞·ª£n</span>
                                <span class="stat-value" id="totalBorrowed">0</span>
                                <span class="stat-sub">ƒêang ho·∫°t ƒë·ªông</span>
                            </div>
                            <div class="stat-icon icon-primary">
                                <i class="fa-solid fa-book-open"></i>
                            </div>
                        </div>
                        <div class="stat-card border-warning">
                            <div class="stat-content">
                                <span class="stat-label">S·∫Øp ƒë·∫øn h·∫°n</span>
                                <span class="stat-value text-warning-bold" id="nearDue">0</span>
                                <span class="stat-sub">Trong 3 ng√†y t·ªõi</span>
                            </div>
                            <div class="stat-icon icon-warning">
                                <i class="fa-solid fa-clock"></i>
                            </div>
                        </div>
                        <div class="stat-card border-danger">
                            <div class="stat-content">
                                <span class="stat-label">Qu√° h·∫°n</span>
                                <span class="stat-value text-danger-bold" id="overdue">0</span>
                                <span class="stat-sub">C·∫ßn ch√∫ √Ω</span>
                            </div>
                            <div class="stat-icon icon-danger">
                                <i class="fa-solid fa-exclamation-triangle"></i>
                            </div>
                        </div>
                        <div class="stat-card border-success">
                            <div class="stat-content">
                                <span class="stat-label">ƒê√£ tr·∫£</span>
                                <span class="stat-value text-success-bold" id="totalReturned">0</span>
                                <span class="stat-sub">Ho√†n th√†nh</span>
                            </div>
                            <div class="stat-icon icon-success">
                                <i class="fa-solid fa-check-circle"></i>
                            </div>
                        </div>
                    </div>

                    <div class="section-card">
                        <div class="section-header">
                            <h3>Qu·∫£n l√Ω s√°ch ƒëang m∆∞·ª£n</h3>
                            <div class="cart-actions">
                                <button class="btn btn-success" onclick="returnAllBooks()">
                                    <i class="fa-solid fa-check-double"></i> Tr·∫£ t·∫•t c·∫£
                                </button>
                                <button class="btn btn-warning" onclick="renewAllBooks()">
                                    <i class="fa-solid fa-sync-alt"></i> Gia h·∫°n t·∫•t c·∫£
                                </button>
                                <button class="btn btn-primary" onclick="window.location.href='books.html'">
                                    <i class="fa-solid fa-plus"></i> M∆∞·ª£n th√™m s√°ch
                                </button>
                            </div>
                        </div>
                        
                        <div class="cart-table-container">
                            <table class="cart-table" id="cartTable">
                                <thead>
                                    <tr>
                                        <th width="40%">Th√¥ng tin s√°ch</th>
                                        <th width="15%">Ng√†y m∆∞·ª£n</th>
                                        <th width="15%">H·∫°n tr·∫£</th>
                                        <th width="15%">Tr·∫°ng th√°i</th>
                                        <th width="15%">Thao t√°c</th>
                                    </tr>
                                </thead>
                                <tbody id="cartTableBody">
                                    <!-- S√°ch s·∫Ω ƒë∆∞·ª£c t·∫£i ·ªü ƒë√¢y -->
                                </tbody>
                            </table>
                        </div>

                        <div class="empty-cart" id="emptyCart" style="display: none;">
                            <div class="empty-icon">
                                <i class="fa-solid fa-shopping-cart"></i>
                            </div>
                            <h3>Gi·ªè h√†ng tr·ªëng</h3>
                            <p>B·∫°n ch∆∞a m∆∞·ª£n s√°ch n√†o. H√£y ch·ªçn s√°ch ƒë·ªÉ m∆∞·ª£n!</p>
                            <button class="btn btn-primary" onclick="window.location.href='books.html'" style="margin-top: 20px;">
                                <i class="fa-solid fa-book"></i> ƒê·∫øn danh m·ª•c s√°ch
                            </button>
                        </div>
                    </div>

                    <div class="cart-summary" id="cartSummary" style="display: none;">
                        <div class="section-header">
                            <i class="fa-solid fa-file-alt"></i>
                            <h3>T√≥m t·∫Øt m∆∞·ª£n s√°ch</h3>
                        </div>
                        <div class="summary-content">
                            <div class="summary-item">
                                <span class="summary-label">S·ªë s√°ch ƒëang m∆∞·ª£n:</span>
                                <span class="summary-value" id="summaryBorrowing">0</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">S√°ch s·∫Øp ƒë·∫øn h·∫°n:</span>
                                <span class="summary-value" id="summaryNearDue">0</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">S√°ch qu√° h·∫°n:</span>
                                <span class="summary-value" id="summaryOverdue">0</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">S·ªë ng√†y m∆∞·ª£n trung b√¨nh:</span>
                                <span class="summary-value" id="summaryAvgDays">0</span>
                            </div>
                            <div class="summary-total">
                                <span class="total-label">T·ªïng s·ªë s√°ch ƒë√£ m∆∞·ª£n:</span>
                                <span class="total-value" id="summaryTotal">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <footer class="main-footer">
                <div class="footer-center">
                    <img src="https://cdn-icons-png.flaticon.com/512/2232/2232688.png" alt="Logo" class="footer-logo">
                    <span>Th∆∞ vi·ªán HAUI</span>
                </div>
                <div class="footer-right">
                    <span>¬© 2025 Th∆∞ vi·ªán HAUI</span>
                    <a href="#" onclick="showDemoAlert('Ch√≠nh s√°ch ri√™ng t∆∞')">S·ª± ri√™ng t∆∞</a>
                    <a href="#" onclick="showDemoAlert('ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng')">ƒêi·ªÅu kho·∫£n</a>
                </div>
            </footer>
        </main>
    </div>

    <!-- Modal chi ti·∫øt s√°ch -->
    <div class="modal-overlay" id="bookModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modalTitle">Chi ti·∫øt m∆∞·ª£n s√°ch</h2>
                <p id="modalSubtitle"></p>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn b·∫±ng JS -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">ƒê√≥ng</button>
                <button class="btn btn-success" id="modalReturnBtn" onclick="returnSelectedBook()">Tr·∫£ s√°ch</button>
                <button class="btn btn-warning" id="modalRenewBtn" onclick="renewSelectedBook()">Gia h·∫°n</button>
            </div>
        </div>
    </div>

    <script>
        // Bi·∫øn to√†n c·ª•c
        let currentUserId = 3; // ID c·ªßa Nguy·ªÖn VƒÉn A
        let currentBorrowId = null;

        // Kh·ªüi t·∫°o trang
        document.addEventListener('DOMContentLoaded', function() {
            loadCartData();
        });

        function loadCartData() {
            const data = JSON.parse(localStorage.getItem('libraryData')) || { muonTra: [], sach: [], theLoai: [] };
            const userBorrowedBooks = data.muonTra.filter(record => record.docGiaId === currentUserId);
            
            updateStats(userBorrowedBooks);
            displayCartTable(userBorrowedBooks, data.sach, data.theLoai);
            updateCartBadge(userBorrowedBooks);
        }

        function updateStats(borrowedBooks) {
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            
            // T√≠nh s·ªë s√°ch ƒëang m∆∞·ª£n
            const totalBorrowing = borrowedBooks.filter(book => book.trangThai === "ƒêang m∆∞·ª£n").length;
            document.getElementById('totalBorrowed').textContent = totalBorrowing;
            
            // T√≠nh s·ªë s√°ch s·∫Øp ƒë·∫øn h·∫°n (trong 3 ng√†y t·ªõi)
            const nearDue = borrowedBooks.filter(book => {
                if (book.trangThai !== "ƒêang m∆∞·ª£n") return false;
                const dueDate = new Date(book.hanTra);
                const timeDiff = dueDate - now;
                const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                return daysDiff <= 3 && daysDiff > 0;
            }).length;
            document.getElementById('nearDue').textContent = nearDue;
            
            // T√≠nh s·ªë s√°ch qu√° h·∫°n
            const overdue = borrowedBooks.filter(book => {
                if (book.trangThai !== "ƒêang m∆∞·ª£n") return false;
                return book.hanTra < today;
            }).length;
            document.getElementById('overdue').textContent = overdue;
            
            // T√≠nh s·ªë s√°ch ƒë√£ tr·∫£
            const totalReturned = borrowedBooks.filter(book => book.trangThai === "ƒê√£ tr·∫£").length;
            document.getElementById('totalReturned').textContent = totalReturned;
        }

        function displayCartTable(borrowedBooks, allBooks, allCategories) {
            const tableBody = document.getElementById('cartTableBody');
            const emptyCart = document.getElementById('emptyCart');
            const cartSummary = document.getElementById('cartSummary');
            
            if (borrowedBooks.length === 0) {
                tableBody.innerHTML = '';
                emptyCart.style.display = 'block';
                cartSummary.style.display = 'none';
                return;
            }
            
            emptyCart.style.display = 'none';
            cartSummary.style.display = 'block';
            tableBody.innerHTML = '';
            
            // Ch·ªâ hi·ªÉn th·ªã s√°ch ƒëang m∆∞·ª£n
            const activeBorrows = borrowedBooks.filter(book => book.trangThai === "ƒêang m∆∞·ª£n");
            
            activeBorrows.forEach(borrow => {
                const book = allBooks.find(b => b.id === borrow.sachId);
                if (!book) return;
                
                const now = new Date();
                const dueDate = new Date(borrow.hanTra);
                const timeDiff = dueDate - now;
                const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                
                let statusClass = 'status-borrowing';
                let statusText = 'ƒêang m∆∞·ª£n';
                
                if (borrow.hanTra < now.toISOString().split('T')[0]) {
                    statusClass = 'status-overdue';
                    statusText = 'Qu√° h·∫°n';
                } else if (daysDiff <= 3) {
                    statusClass = 'status-borrowing';
                    statusText = 'S·∫Øp ƒë·∫øn h·∫°n';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="book-info-cell">
                            <div class="book-cover">
                                <i class="fa-solid fa-book"></i>
                            </div>
                            <div class="book-details">
                                <div class="book-title">${book.tieuDe}</div>
                                <div class="book-author">${book.tacGia}</div>
                            </div>
                        </div>
                    </td>
                    <td class="due-date">${borrow.ngayMuon}</td>
                    <td class="due-date">${borrow.hanTra}</td>
                    <td>
                        <span class="status-badge ${statusClass}">${statusText}</span>
                    </td>
                    <td>
                        <div class="action-cell">
                            <button class="action-btn btn-detail" onclick="viewBookDetail(${borrow.id})">
                                <i class="fa-solid fa-info-circle"></i> Chi ti·∫øt
                            </button>
                            <button class="action-btn btn-return" onclick="returnBook(${borrow.id})">
                                <i class="fa-solid fa-check"></i> Tr·∫£ s√°ch
                            </button>
                            <button class="action-btn btn-renew" onclick="renewBook(${borrow.id})" ${statusClass === 'status-overdue' ? 'disabled' : ''}>
                                <i class="fa-solid fa-sync-alt"></i> Gia h·∫°n
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            updateSummary(activeBorrows);
        }

        function updateSummary(borrowedBooks) {
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            
            const borrowing = borrowedBooks.length;
            const nearDue = borrowedBooks.filter(book => {
                const dueDate = new Date(book.hanTra);
                const timeDiff = dueDate - now;
                const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                return daysDiff <= 3 && daysDiff > 0;
            }).length;
            
            const overdue = borrowedBooks.filter(book => book.hanTra < today).length;
            
            // T√≠nh s·ªë ng√†y m∆∞·ª£n trung b√¨nh
            const avgDays = borrowedBooks.length > 0 ? 
                borrowedBooks.reduce((sum, book) => {
                    const borrowDate = new Date(book.ngayMuon);
                    const days = Math.ceil((now - borrowDate) / (1000 * 60 * 60 * 24));
                    return sum + days;
                }, 0) / borrowedBooks.length : 0;
            
            document.getElementById('summaryBorrowing').textContent = borrowing;
            document.getElementById('summaryNearDue').textContent = nearDue;
            document.getElementById('summaryOverdue').textContent = overdue;
            document.getElementById('summaryAvgDays').textContent = avgDays.toFixed(1);
            document.getElementById('summaryTotal').textContent = borrowing;
        }

        function updateCartBadge(borrowedBooks) {
            const activeBorrows = borrowedBooks.filter(book => book.trangThai === "ƒêang m∆∞·ª£n").length;
            document.getElementById('cartBadge').textContent = activeBorrows;
        }

        function viewBookDetail(borrowId) {
            const data = JSON.parse(localStorage.getItem('libraryData')) || { muonTra: [], sach: [], theLoai: [] };
            const borrow = data.muonTra.find(b => b.id === borrowId);
            const book = data.sach.find(b => b.id === borrow.sachId);
            const category = data.theLoai.find(cat => cat.id === book.theLoaiId);
            
            if (!borrow || !book) return;
            
            currentBorrowId = borrowId;
            
            document.getElementById('modalTitle').textContent = 'Chi ti·∫øt m∆∞·ª£n s√°ch';
            document.getElementById('modalSubtitle').textContent = book.tieuDe;
            
            const now = new Date();
            const dueDate = new Date(borrow.hanTra);
            const timeDiff = dueDate - now;
            const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
            
            let statusText = 'ƒêang m∆∞·ª£n';
            let statusColor = 'primary';
            
            if (borrow.hanTra < now.toISOString().split('T')[0]) {
                statusText = 'Qu√° h·∫°n';
                statusColor = 'danger';
            } else if (daysDiff <= 3) {
                statusText = 'S·∫Øp ƒë·∫øn h·∫°n';
                statusColor = 'warning';
            }
            
            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `
                <div class="modal-section">
                    <h3>Th√¥ng tin m∆∞·ª£n s√°ch</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">T√™n s√°ch</span>
                            <span class="info-value">${book.tieuDe}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">T√°c gi·∫£</span>
                            <span class="info-value">${book.tacGia}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Ng√†y m∆∞·ª£n</span>
                            <span class="info-value">${borrow.ngayMuon}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">H·∫°n tr·∫£</span>
                            <span class="info-value">${borrow.hanTra}</span>
                        </div>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h3>Th√¥ng tin s√°ch</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">M√£ s√°ch</span>
                            <span class="info-value">${book.id}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Th·ªÉ lo·∫°i</span>
                            <span class="info-value">${category ? category.ten : 'Kh√¥ng x√°c ƒë·ªãnh'}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">NƒÉm xu·∫•t b·∫£n</span>
                            <span class="info-value">${book.namXuatBan}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ISBN</span>
                            <span class="info-value">978-0-${String(book.id).padStart(6, '0')}-${String(book.namXuatBan).slice(-2)}</span>
                        </div>
                    </div>
                </div>
                
                <div class="status-display">
                    <div class="status-header">
                        <div>
                            <div class="status-label">Tr·∫°ng th√°i</div>
                            <div class="status-value ${statusColor}">${statusText}</div>
                        </div>
                        <div class="days-remaining ${statusColor}">
                            ${daysDiff > 0 ? `C√≤n ${daysDiff} ng√†y` : 'ƒê√£ qu√° h·∫°n'}
                        </div>
                    </div>
                    <div class="stock-info">
                        <div>S·ªë l∆∞·ª£ng c√≤n trong kho: <span class="stock-count">${book.soLuong}</span></div>
                        <div>T√¨nh tr·∫°ng: ${getStockStatus(book.soLuong)}</div>
                    </div>
                </div>
                
                ${book.description ? `
                <div class="modal-section">
                    <h3>M√¥ t·∫£</h3>
                    <div class="description">
                        ${book.description}
                    </div>
                </div>
                ` : ''}
            `;
            
            const returnBtn = document.getElementById('modalReturnBtn');
            const renewBtn = document.getElementById('modalRenewBtn');
            
            returnBtn.style.display = 'inline-block';
            renewBtn.style.display = statusText === 'Qu√° h·∫°n' ? 'none' : 'inline-block';
            renewBtn.disabled = statusText === 'Qu√° h·∫°n';
            
            openModal();
        }

        function getStockStatus(quantity) {
            if (quantity === 0) return 'H·∫øt s√°ch';
            if (quantity <= 5) return 'S·∫Øp h·∫øt';
            if (quantity <= 10) return 'C√≤n √≠t';
            return 'C√≤n nhi·ªÅu';
        }

        function returnBook(borrowId) {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën tr·∫£ s√°ch n√†y?')) {
                const data = JSON.parse(localStorage.getItem('libraryData')) || { muonTra: [], sach: [] };
                const borrowIndex = data.muonTra.findIndex(b => b.id === borrowId);
                
                if (borrowIndex !== -1) {
                    const borrow = data.muonTra[borrowIndex];
                    const bookIndex = data.sach.findIndex(b => b.id === borrow.sachId);
                    
                    if (bookIndex !== -1) {
                        data.sach[bookIndex].soLuong += 1;
                    }
                    
                    data.muonTra[borrowIndex].trangThai = "ƒê√£ tr·∫£";
                    localStorage.setItem('libraryData', JSON.stringify(data));
                    
                    loadCartData();
                    closeModal();
                    alert('‚úÖ ƒê√£ tr·∫£ s√°ch th√†nh c√¥ng!');
                }
            }
        }

        function renewBook(borrowId) {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën gia h·∫°n th√™m 7 ng√†y?')) {
                const data = JSON.parse(localStorage.getItem('libraryData')) || { muonTra: [] };
                const borrowIndex = data.muonTra.findIndex(b => b.id === borrowId);
                
                if (borrowIndex !== -1) {
                    const currentDate = new Date(data.muonTra[borrowIndex].hanTra);
                    currentDate.setDate(currentDate.getDate() + 7);
                    data.muonTra[borrowIndex].hanTra = currentDate.toISOString().split('T')[0];
                    
                    localStorage.setItem('libraryData', JSON.stringify(data));
                    
                    loadCartData();
                    closeModal();
                    alert('‚úÖ ƒê√£ gia h·∫°n th√†nh c√¥ng th√™m 7 ng√†y!');
                }
            }
        }

        function returnSelectedBook() {
            if (currentBorrowId) {
                returnBook(currentBorrowId);
            }
        }

        function renewSelectedBook() {
            if (currentBorrowId) {
                renewBook(currentBorrowId);
            }
        }

        function returnAllBooks() {
            const data = JSON.parse(localStorage.getItem('libraryData')) || { muonTra: [], sach: [] };
            const activeBorrows = data.muonTra.filter(record => 
                record.docGiaId === currentUserId && record.trangThai === "ƒêang m∆∞·ª£n"
            );
            
            if (activeBorrows.length === 0) {
                alert('Kh√¥ng c√≥ s√°ch n√†o ƒë·ªÉ tr·∫£!');
                return;
            }
            
            if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën tr·∫£ t·∫•t c·∫£ ${activeBorrows.length} s√°ch?`)) {
                activeBorrows.forEach(borrow => {
                    const borrowIndex = data.muonTra.findIndex(b => b.id === borrow.id);
                    if (borrowIndex !== -1) {
                        const bookIndex = data.sach.findIndex(b => b.id === borrow.sachId);
                        if (bookIndex !== -1) {
                            data.sach[bookIndex].soLuong += 1;
                        }
                        data.muonTra[borrowIndex].trangThai = "ƒê√£ tr·∫£";
                    }
                });
                
                localStorage.setItem('libraryData', JSON.stringify(data));
                loadCartData();
                alert(`‚úÖ ƒê√£ tr·∫£ th√†nh c√¥ng ${activeBorrows.length} s√°ch!`);
            }
        }

        function renewAllBooks() {
            const data = JSON.parse(localStorage.getItem('libraryData')) || { muonTra: [] };
            const activeBorrows = data.muonTra.filter(record => 
                record.docGiaId === currentUserId && 
                record.trangThai === "ƒêang m∆∞·ª£n" &&
                record.hanTra >= new Date().toISOString().split('T')[0]
            );
            
            if (activeBorrows.length === 0) {
                alert('Kh√¥ng c√≥ s√°ch n√†o c√≥ th·ªÉ gia h·∫°n!');
                return;
            }
            
            if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën gia h·∫°n t·∫•t c·∫£ ${activeBorrows.length} s√°ch th√™m 7 ng√†y?`)) {
                activeBorrows.forEach(borrow => {
                    const borrowIndex = data.muonTra.findIndex(b => b.id === borrow.id);
                    if (borrowIndex !== -1) {
                        const currentDate = new Date(data.muonTra[borrowIndex].hanTra);
                        currentDate.setDate(currentDate.getDate() + 7);
                        data.muonTra[borrowIndex].hanTra = currentDate.toISOString().split('T')[0];
                    }
                });
                
                localStorage.setItem('libraryData', JSON.stringify(data));
                loadCartData();
                alert(`‚úÖ ƒê√£ gia h·∫°n th√†nh c√¥ng ${activeBorrows.length} s√°ch!`);
            }
        }

        function openModal() {
            document.getElementById('bookModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('bookModal').style.display = 'none';
            currentBorrowId = null;
        }

        function logout() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t?')) {
                alert('ƒêƒÉng xu·∫•t th√†nh c√¥ng!');
            }
        }
        
        function showDemoAlert(feature) {
            alert(`T√≠nh nƒÉng "${feature}" ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn. Vui l√≤ng th·ª≠ l·∫°i sau!`);
        }

        // ƒê√≥ng modal khi click b√™n ngo√†i
        document.getElementById('bookModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>